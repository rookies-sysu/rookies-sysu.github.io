<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Flask-SQLAlchemy å­¦ä¹ æŠ¥å‘Š - Tiny Hippo åšå®¢</title>
  
  <meta name="description" content="å®éªŒç¯å¢ƒ Ubuntu 16.04 LTS
Anaconda 5.1
python 3.6
ä»€ä¹ˆæ˜¯Flask Flaskæ˜¯ä¸€ä¸ªä½¿ç”¨Pythonå¼€å‘çš„â€œå¾®å‹â€Webæ¡†æ¶ï¼Œå…¶â€œå¾®å‹â€çš„ç›®çš„åœ¨äºï¼Œä¿æŒä¸€ä¸ªâ€œç®€å•â€å¹¶ä¸”â€œå¯æ‰©å±•â€çš„æ¡†æ¶æ ¸å¿ƒï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªé€‰æ‹©è‡ªç”±çš„Webæ¡†æ¶ã€‚åŸºäºæ­¤ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±çš„é€‰æ‹©æ•°æ®åº“æˆ–æ¨¡æ¿å¼•æ“ï¼Œä¸ºè‡ªå·±çš„Webåº”ç”¨åšåˆé€‚çš„é€‰æ‹©ã€‚
ä»€ä¹ˆæ˜¯SQLAlchemy SQLAlchemyæ˜¯ä¸€ä¸ªORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ã€‚åŸºäºå¯¹ç›®æ ‡æ•°æ®åº“çš„åŸç”ŸSQLçš„æŠ½è±¡ï¼Œå®ƒæä¾›äº†ä¸ä¸€é•¿ä¸²æ•°æ®åº“å¼•æ“çš„ä¸€è‡´çš„APIï¼Œå…¶ä¸­åŒ…æ‹¬MySQLï¼ŒPostgreSQLï¼Œå’ŒSQLiteã€‚ä½¿å¾—åœ¨ä½ çš„æ¨¡å‹å’Œæ•°æ®åº“é—´äº¤æ¢æ•°æ®æ—¶ï¼Œå¸¦æ¥äº†ä¾¿åˆ©ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†è¯¸å¦‚æ¢æ‰æ•°æ®åº“å¼•æ“å’Œè¿ç§»æ•°æ®åº“æ¨¡å¼ç­‰å…¶ä»–äº‹æƒ…ã€‚
ä»€ä¹ˆæ˜¯Flask-SQLAlchemy Flask-SQLAlchemyæ˜¯ä¸€ä¸ªFlaskæ’ä»¶ï¼Œä½¿å¾—åœ¨Flaskä¸­ä½¿ç”¨SQLAlchemyæ›´ä¸ºæ–¹ä¾¿ã€‚å®ƒä¸ºSQLAlchemyè®¾ç½®äº†è®¸å¤šåˆç†çš„é…ç½®ï¼ŒåŒæ—¶å†…ç½®äº†ä¸€äº›sessionç®¡ç†ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨åº”ç”¨ä»£ç é‡Œå¤„ç†è¿™ç§åŸºç¡€äº‹åŠ¡äº†ã€‚
å®‰è£… Flask-SQLAlchemy pip install flask-sqlalchemy  æ•°æ®åº“ç®¡ç† 1 é…ç½®æ•°æ®åº“ é¦–å…ˆåˆå§‹åŒ–å¹¶é…ç½®Flaskåº”ç”¨ï¼Œç„¶åç”¨å®ƒæ¥åˆå§‹åŒ–SQLAlchemyæ•°æ®åº“å¤„ç†ç¨‹åºã€‚ä¸ºæ•°æ®åº“é…ç½®ä½¿ç”¨ä¸€ä¸ªinstanceæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åº”è¯¥åœ¨åˆå§‹åŒ–åº”ç”¨æ—¶åŠ ä¸Šinstance_relative_configé€‰é¡¹ï¼Œç„¶åè°ƒç”¨app.config.from_pyfileã€‚
# myapp/__init__.py from flask import Flask from flask_sqlalchemy import SQLAlchemy app = Flask(__name__, instance_relative_config=True) app.config.from_object(&#39;config&#39;) app.config.from_pyfile(&#39;config.py&#39;) db = SQLAlchemy(app)  2 å®šä¹‰æ¨¡å‹ Columnï¼ŒIntegerï¼ŒStringï¼ŒModelå’Œå…¶ä»–çš„SQLAlchemyç±»éƒ½å¯ä»¥é€šè¿‡ç”±Flask-SQLAlchemyæ„é€ çš„dbå¯¹è±¡è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‚¨å­˜ç”¨æˆ·ä¿¡æ¯çš„æ¨¡å‹ã€‚æ¯ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªIDå’Œä¸€ä¸ªç”¨æˆ·åã€‚
# myapp/models.py from . import db class User(db.Model): id = db.Column(db.Integer, primary_key=True, autoincrement=True) username = db.Column(db.String(80), unique=True) def __init__(self, username): self.username = username def __repr__(self): return &#39;&lt;User %r&gt;&#39; % self.">
  <meta name="author" content="">
  
  
  <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.ico">
  
  <meta name="generator" content="Hugo 0.37.1">
  
  <link rel="alternate" type="application/atom+xml" href="/index.xml" title="Tiny Hippo åšå®¢">
</head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="/"><span>ğŸ±</span>Tiny Hippo åšå®¢</a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view">
  <header class="post-header">
    <h1 class="post-title">Flask-SQLAlchemy å­¦ä¹ æŠ¥å‘Š</h1>
    <p class="post-meta">2018.4.15</p>
  </header>
  <div class="post-content">

<h2 id="å®éªŒç¯å¢ƒ">å®éªŒç¯å¢ƒ</h2>

<p>Ubuntu 16.04 LTS</p>

<p>Anaconda 5.1</p>

<p>python 3.6</p>

<h2 id="ä»€ä¹ˆæ˜¯flask">ä»€ä¹ˆæ˜¯Flask</h2>

<p>Flaskæ˜¯ä¸€ä¸ªä½¿ç”¨Pythonå¼€å‘çš„â€œå¾®å‹â€Webæ¡†æ¶ï¼Œå…¶â€œå¾®å‹â€çš„ç›®çš„åœ¨äºï¼Œä¿æŒä¸€ä¸ªâ€œç®€å•â€å¹¶ä¸”â€œå¯æ‰©å±•â€çš„æ¡†æ¶æ ¸å¿ƒï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªé€‰æ‹©è‡ªç”±çš„Webæ¡†æ¶ã€‚åŸºäºæ­¤ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±çš„é€‰æ‹©æ•°æ®åº“æˆ–æ¨¡æ¿å¼•æ“ï¼Œä¸ºè‡ªå·±çš„Webåº”ç”¨åšåˆé€‚çš„é€‰æ‹©ã€‚</p>

<h2 id="ä»€ä¹ˆæ˜¯sqlalchemy">ä»€ä¹ˆæ˜¯SQLAlchemy</h2>

<p>SQLAlchemyæ˜¯ä¸€ä¸ªORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ã€‚åŸºäºå¯¹ç›®æ ‡æ•°æ®åº“çš„åŸç”ŸSQLçš„æŠ½è±¡ï¼Œå®ƒæä¾›äº†ä¸ä¸€é•¿ä¸²æ•°æ®åº“å¼•æ“çš„ä¸€è‡´çš„APIï¼Œå…¶ä¸­åŒ…æ‹¬MySQLï¼ŒPostgreSQLï¼Œå’ŒSQLiteã€‚ä½¿å¾—åœ¨ä½ çš„æ¨¡å‹å’Œæ•°æ®åº“é—´äº¤æ¢æ•°æ®æ—¶ï¼Œå¸¦æ¥äº†ä¾¿åˆ©ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†è¯¸å¦‚æ¢æ‰æ•°æ®åº“å¼•æ“å’Œè¿ç§»æ•°æ®åº“æ¨¡å¼ç­‰å…¶ä»–äº‹æƒ…ã€‚</p>

<h2 id="ä»€ä¹ˆæ˜¯flask-sqlalchemy">ä»€ä¹ˆæ˜¯Flask-SQLAlchemy</h2>

<p>Flask-SQLAlchemyæ˜¯ä¸€ä¸ªFlaskæ’ä»¶ï¼Œä½¿å¾—åœ¨Flaskä¸­ä½¿ç”¨SQLAlchemyæ›´ä¸ºæ–¹ä¾¿ã€‚å®ƒä¸ºSQLAlchemyè®¾ç½®äº†è®¸å¤šåˆç†çš„é…ç½®ï¼ŒåŒæ—¶å†…ç½®äº†ä¸€äº›sessionç®¡ç†ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨åº”ç”¨ä»£ç é‡Œå¤„ç†è¿™ç§åŸºç¡€äº‹åŠ¡äº†ã€‚</p>

<h2 id="å®‰è£…-flask-sqlalchemy">å®‰è£… Flask-SQLAlchemy</h2>

<pre><code class="language-shell">pip install flask-sqlalchemy
</code></pre>

<h2 id="æ•°æ®åº“ç®¡ç†">æ•°æ®åº“ç®¡ç†</h2>

<h3 id="1-é…ç½®æ•°æ®åº“">1 é…ç½®æ•°æ®åº“</h3>

<p>é¦–å…ˆåˆå§‹åŒ–å¹¶é…ç½®Flaskåº”ç”¨ï¼Œç„¶åç”¨å®ƒæ¥åˆå§‹åŒ–SQLAlchemyæ•°æ®åº“å¤„ç†ç¨‹åºã€‚ä¸ºæ•°æ®åº“é…ç½®ä½¿ç”¨ä¸€ä¸ªinstanceæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åº”è¯¥åœ¨åˆå§‹åŒ–åº”ç”¨æ—¶åŠ ä¸Š<code>instance_relative_config</code>é€‰é¡¹ï¼Œç„¶åè°ƒç”¨<code>app.config.from_pyfile</code>ã€‚</p>

<pre><code class="language-python"># myapp/__init__.py
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__, instance_relative_config=True)

app.config.from_object('config')
app.config.from_pyfile('config.py')

db = SQLAlchemy(app)
</code></pre>

<h3 id="2-å®šä¹‰æ¨¡å‹">2 å®šä¹‰æ¨¡å‹</h3>

<p><code>Column</code>ï¼Œ<code>Integer</code>ï¼Œ<code>String</code>ï¼Œ<code>Model</code>å’Œå…¶ä»–çš„SQLAlchemyç±»éƒ½å¯ä»¥é€šè¿‡ç”±Flask-SQLAlchemyæ„é€ çš„<code>db</code>å¯¹è±¡è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‚¨å­˜ç”¨æˆ·ä¿¡æ¯çš„æ¨¡å‹ã€‚æ¯ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªIDå’Œä¸€ä¸ªç”¨æˆ·åã€‚</p>

<pre><code class="language-python"># myapp/models.py
from . import db

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True, autoincrement=True)
    username = db.Column(db.String(80), unique=True)
    
    def __init__(self, username):
        self.username = username

    def __repr__(self):
        return '&lt;User %r&gt;' % self.username
</code></pre>

<h3 id="3-æ•°æ®åº“åŸºæœ¬æ“ä½œ">3 æ•°æ®åº“åŸºæœ¬æ“ä½œ</h3>

<ul>
<li>åˆ›å»ºè¡¨</li>
</ul>

<pre><code class="language-python">  from . import db
  db.create_all()
</code></pre>

<ul>
<li>åˆ é™¤è¡¨</li>
</ul>

<pre><code class="language-python">  db.drop_all()
</code></pre>

<ul>
<li>åˆ›å»ºè¡Œ</li>
</ul>

<pre><code class="language-python">  # create object
  user_Bob = User(username='Bob')
  # add object to session
  db.session.add(user_Bob)
  # commit session to insert object into database
  db.session.commit()
</code></pre>

<ul>
<li>åˆ é™¤è¡Œ</li>
</ul>

<pre><code class="language-python">  db.session.delete(user_Bob)
  session.commit()
</code></pre>

<ul>
<li>ä¿®æ”¹è¡Œ</li>
</ul>

<pre><code class="language-python">  user_Bob.username = 'Bobb'
  db.session.add(user_Bob)
  session.commit()
</code></pre>

<ul>
<li>æŸ¥è¯¢è¡Œ</li>
</ul>

<pre><code class="language-python">  Bob = User.query.filter_by(username='Bob')
</code></pre>

<p>â€‹</p>

<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li><a href="https://spacewander.github.io/explore-flask-zh">Flaskä¹‹æ—…</a></li>
<li><a href="http://www.pythondoc.com/flask-sqlalchemy/quickstart.html">Flask-SQLAlchemy å¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://segmentfault.com/a/1190000013155090">flaskæ–‡æ¡£å­¦ä¹ ç¬”è®°1-å¿«é€Ÿå…¥é—¨</a></li>
</ol>
</div>
  <footer class="post-footer">
    
  </footer>
  
</article>
</main>
<footer class="footer">
  <span>&copy; 2017-2018 Tiny Hippo åšå®¢ ğŸ‰</span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" target="_blank">Hugoâ¤ï¸ï¸</a></span>
  <span>&middot;</span>
  <span>Designed by <a href="http://21beats.com/" target="_blank">ï¸21beatsâš¡ï¸</a></span>
</footer>
<script src="https://cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" data-no-instant></script>
<script data-no-instant>
  hljs.initHighlightingOnLoad();
  menuToggle();
  InstantClick.on('change', function() {
    var blocks = document.querySelectorAll('pre code');
    for (var i = 0; i < blocks.length; i++) {
      hljs.highlightBlock(blocks[i]);
    }
    menuToggle();
  });
  function menuToggle() {
    var $toggle = document.querySelector('.menu-toggle');
    if (!$toggle.offsetParent) {
      return;
    }
    var $body = document.querySelector('body');
    $toggle.addEventListener('click', function() {
      $body.classList.toggle('noscroll');
    }, false);
  }
</script>
</body>
</html>

